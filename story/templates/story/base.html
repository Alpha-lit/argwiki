{% load static %}
<!doctype html>
<html lang="en" class="h-full bg-black">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}ARG Wiki{% endblock %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Special+Elite&family=Creepster&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'story/css/styles.css' %}">
  
</head>
<body class="h-full text-zinc-100 selection:bg-red-600/60">
  <!-- Full width header with navigation -->
  <div class="full-width-container bg-black border-b border-red-900">
    <div class="max-w-6xl mx-auto p-4">
      <div class="flex items-center justify-between mb-4">
        <h1 class="creepy-font text-3xl text-red-600 flicker">THE DISNEY WIKI</h1>
        <div class="flex items-center">
          <span class="text-zinc-500 mr-2 special-font">SFX</span>
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" id="sfx-toggle" class="sr-only peer">
            {% if room.sfx_enter %}
            <input type="hidden" id="room-sfx-url" value="{{ room.sfx_enter.url }}">
            {% endif %}
            <div class="w-12 h-6 bg-zinc-800 rounded-full peer peer-checked:bg-red-600 relative">
              <div class="absolute top-1 left-1 w-4 h-4 bg-red-600 rounded-full transition-transform peer-checked:translate-x-6"></div>
            </div>
          </label>
        </div>
      </div>
      
<!-- Desktop Navigation -->
<nav class="hidden md:flex justify-center items-center special-font text-lg">
  <div class="nav-item">
    <a href="{% url 'tape_list' %}">
      <span class="glitch-effect" data-text="Tapes">Tapes</span>
    </a>
    <div class="blood-drip"></div><div class="blood-drip"></div><div class="blood-drip"></div>
    <div class="whisper special-font text-xs absolute -bottom-5 left-0 right-0 text-center text-red-400">do not rewind...</div>
  </div>
  <span class="separator">|</span>

  <div class="nav-item">
    <a href="{% url 'character_list' %}">
      <span class="glitch-effect" data-text="Characters">Characters</span>
    </a>
    <div class="blood-drip"></div><div class="blood-drip"></div><div class="blood-drip"></div>
    <div class="whisper special-font text-xs absolute -bottom-5 left-0 right-0 text-center text-red-400">some are not human</div>
  </div>
  <span class="separator">|</span>

  <div class="nav-item">
    <a href="{% url 'cast_list' %}">
      <span class="glitch-effect" data-text="Cast">Cast</span>
    </a>
    <div class="blood-drip"></div><div class="blood-drip"></div><div class="blood-drip"></div>
    <!-- <div class="whisper special-font text-xs absolute -bottom-5 left-0 right-0 text-center text-red-400">they're always watching</div> -->
  </div>
  <span class="separator">|</span>

  <div class="nav-item">
    <a href="{% url 'news_list' %}">
      <span class="glitch-effect" data-text="News">News</span>
    </a>
    <div class="blood-drip"></div><div class="blood-drip"></div><div class="blood-drip"></div>
    <div class="whisper special-font text-xs absolute -bottom-5 left-0 right-0 text-center text-red-400">the truth is out there</div>
  </div>
</nav>

<!-- Mobile Navigation Toggle -->
<div class="md:hidden flex justify-center mt-4">
  <button id="mobile-menu-toggle" class="px-4 py-2 bg-zinc-900 border border-zinc-700 special-font flex items-center">
    <span>Menu</span>
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 text-red-500" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
    </svg>
  </button>
</div>

<!-- Mobile Navigation Menu -->
<div id="mobile-menu" class="mobile-menu md:hidden special-font mt-2 bg-zinc-900 border border-zinc-700 rounded max-h-0 overflow-hidden transition-all duration-500">
  <div class="py-2">
    <a href="{% url 'tape_list' %}" class="block py-2 px-4 hover:bg-zinc-800 hover:text-red-400 transition">Tapes</a>
    <a href="{% url 'character_list' %}" class="block py-2 px-4 hover:bg-zinc-800 hover:text-red-400 transition">Characters</a>
    <a href="{% url 'cast_list' %}" class="block py-2 px-4 hover:bg-zinc-800 hover:text-red-400 transition">Cast</a>
    <a href="{% url 'news_list' %}" class="block py-2 px-4 hover:bg-zinc-800 hover:text-red-400 transition">News</a>
  </div>
</div>

  <main class="min-h-screen max-w-6xl mx-auto p-4">
    <div id="content" class="animate-fade content-box p-6 rounded-lg mt-6">
      {% block content %}
        <!-- Your room.html content will be inserted here -->
        <div>
          <h2 class="creepy-font text-2xl text-red-500 mb-4">{{ room.title }}</h2>
          <div class="mb-6 special-font">{{ room.description|safe|linebreaks }}</div>

          {% if room.image %}
            <img src="{{ room.image.url }}" class="mb-4 rounded" alt="{{ room.title }}">
          {% endif %}

          <!-- {% if room.sfx_enter %}
          <audio id="room-sfx" src="{{ room.sfx_enter.url }}" autoplay></audio>
          {% endif %} -->

          <!-- Continue / Restart overlay (only on first room for returning users) -->
          {% if show_continue_overlay %}
          <div id="overlay" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-gray-900 p-8 rounded shadow-xl text-center">
              <p class="text-lg mb-4">You were last in <strong>{{ last_room.title }}</strong>.</p>
              <div class="space-x-4">
                <a href="{% url 'room' slug=last_room.slug %}"
                   class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded">
                   Continue
                </a>
                <a href="{% url 'restart_progress' %}"
                   class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded">
                   Restart
                </a>
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Choices -->
          {% for choice in choices %}
            <form method="post" action="{% url 'pick_choice' choice.id %}" class="space-y-2">
              {% csrf_token %}
              <button type="submit"
                      class="block w-full p-4 bg-gray-800 hover:bg-gray-700 rounded transition special-font">
                {{ choice.text }}
              </button>
            </form>
          {% empty %}
            <p class="text-gray-400 italic">No choices available.</p>
          {% endfor %}
          
          <!-- Navigation -->
          <div class="mt-8 border-t border-gray-700 pt-4 text-sm text-gray-400 space-x-4">
            {% if back_slug %}
              <a href="{% url 'room' slug=back_slug %}"
                 class="hover:text-white transition special-font">
                ← Back
              </a>
            {% endif %}
            {% if request.COOKIES.progress %}
              <a href="{% url 'restart_progress' %}"
                 class="hover:text-white transition special-font">
                Reset Progress
              </a>
            {% endif %}
          </div>
        </div>

        <!-- {% include 'story/components/audio-toggle.html' %} -->

        <!-- Small JS helper to clear the cue-sfx cookie after playing -->
        <script>
        (function () {
          const sfx = document.cookie
            .split("; ")
            .find(row => row.startsWith("_cue_sfx="));
          if (sfx) {
            const url = sfx.split("=")[1];
            const audio = new Audio("{% static 'story/sfx/' %}" + url);
            audio.play();
            document.cookie = "_cue_sfx=; Max-Age=0; path=/";
          }
        })();
        </script>
      {% endblock %}
    </div>
  </main>

  <audio id="sfx" preload="auto"></audio>

  <script src="{% static 'story/js/glitch.js' %}"></script>
  <script src="{% static 'story/js/sfx.js' %}"></script>
  <script src="{% static 'story/js/prog.js' %}"></script>
  <script>
    // Tab title trick: cycles occasionally, or uses room override if provided
    (function(){
      const override = document.querySelector('meta[name="tab-title-override"]')?.content
      if (override) { document.title = override; return; }
      const variants = ["Hi", "hI", "GET OUT", "—   ", "Hi"]; // brief, not constant
      let i = 0;
      setInterval(() => { document.title = variants[(i++) % variants.length]; }, 4000);
    })();
    
    // Mobile menu toggle functionality
    document.getElementById('mobile-menu-toggle').addEventListener('click', function() {
      const menu = document.getElementById('mobile-menu');
      if (menu.classList.contains('max-h-0')) {
        menu.classList.remove('max-h-0');
        menu.classList.add('max-h-96');
      } else {
        menu.classList.add('max-h-0');
        menu.classList.remove('max-h-96');
      }
    });
    
    // Add random flicker to title
    setInterval(() => {
      const title = document.querySelector('.flicker');
      if (Math.random() > 0.7) {
        title.style.opacity = Math.random() * 0.5 + 0.5;
      } else {
        title.style.opacity = 1;
      }
    }, 300);
  </script>
</body>
</html>